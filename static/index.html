<!-- static/index.html -->
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>WebRTC Echo Test</title>
      </head>
<body>
  <h1>ðŸŽ¤ WebRTC Echo í…ŒìŠ¤íŠ¸</h1>
  <button id="start">ì—°ê²° ì‹œìž‘</button>
  <script>
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
    });

    let localStream;

    async function start() {
      localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);

      const response = await fetch('/offer', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(pc.localDescription)
      });

      const answer = await response.json();
      await pc.setRemoteDescription(answer);

      pc.ontrack = (event) => {
        const remoteStream = event.streams[0];
        const audio = new Audio();
        audio.srcObject = remoteStream;
        audio.autoplay = true;
        document.body.appendChild(audio);
      };
    }

    document.getElementById('start').onclick = start;
  </script>
</body>
</html>
